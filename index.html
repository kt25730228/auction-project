<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>ìœ„ë„ˆìŠ¤ ê²½ë§¤ ë°ëª¨ (Fixed - All features v11 - Final)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: system-ui, -apple-system, sans-serif; }
  
  /* ë¶€ë“œëŸ¬ìš´ ë°˜ëŒ€ ê¹œë¹¡ì„ */
  @keyframes fadeA {
    0%, 45% { opacity: 1; }
    55%, 100% { opacity: 0.15; }
  }
  @keyframes fadeB {
    0%, 45% { opacity: 0.15; }
    55%, 100% { opacity: 1; }
  }
  .fade-a { animation: fadeA 3s infinite ease-in-out; }
  .fade-b { animation: fadeB 3s infinite ease-in-out; }

  /* ë‘¥ë‘¥ ë– ë‹¤ë‹ˆëŠ” ì• ë‹ˆë©”ì´ì…˜ */
  @keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
    100% { transform: translateY(0px); }
  }
  .animate-float { animation: float 4s ease-in-out infinite; }
  .animate-float-delay { animation: float 4s ease-in-out infinite; animation-delay: 2s; }
  
  /* ê¸´ ì œëª©ì„ í•œ ì¤„ë¡œ ëª¨ë‘ í‘œì‹œí•˜ê¸° ìœ„í•´ í…ìŠ¤íŠ¸ í¬ê¸°ë¥¼ ë™ì ìœ¼ë¡œ ì¤„ì´ëŠ” ì»¨í…Œì´ë„ˆ */
  .shrink-text-container {
      overflow: hidden;
      white-space: nowrap;
      display: flex;
      align-items: center;
      width: 100%;
      height: 28px; /* ì œëª© í•œ ì¤„ ë†’ì´ ê³ ì • (text-xl í¬ê¸° ê¸°ì¤€) */
  }
  .shrink-text {
      display: inline-block;
      min-width: 100%;
      font-size: 1.25rem; /* ê¸°ë³¸ ì‚¬ì´ì¦ˆ: text-xl */
      line-height: 1.75rem;
      font-weight: 700;
      /* ê¸´ í…ìŠ¤íŠ¸ì¼ ê²½ìš° íŠ¸ëœìŠ¤í¼ìœ¼ë¡œ ì¶•ì†Œ */
      transform-origin: left;
  }
</style>
</head>
<body class="bg-sky-50 min-h-screen text-gray-800">
<div id="app" class="max-w-7xl mx-auto p-6"></div>

<script>


const COMPANIES = ["ì›¹ì¼€ì‹œ","ì¿ ì½˜","ë¹„ì¦ˆí”Œë ˆì´","ë¹„í”Œí˜ì´"];

// ìƒíƒœ ê´€ë¦¬
let state = {
  view: 'main',
  session: null,
  products: [],
  filter: '',
  detail: null,
  timerId: null
};

// í—¬í¼ í•¨ìˆ˜
const el = (tag, attr={}, html='') => {
  const e = document.createElement(tag);
  Object.entries(attr).forEach(([k,v])=>{
    if(k.startsWith('on')) e.addEventListener(k.slice(2),v);
    else if(k==='class') e.className = v;
    else e.setAttribute(k,v);
  });
  if(html) e.innerHTML = html;
  return e;
};
const toast = msg => alert(msg);
const fmt = d => new Date(d).toLocaleString('ko-KR');
const fmtDate = d => new Date(d).toLocaleDateString('ko-KR');
const formatNumber = num => num ? num.toLocaleString() : '0';

// ìˆ«ì ì…ë ¥ í•„ë“œì— ì²œë‹¨ìœ„ ì½¤ë§ˆ ìë™ ì ìš©
const formatInput = (target) => {
    let val = target.value.replace(/[^0-9]/g, '');
    target.value = val ? parseInt(val).toLocaleString() : '';
};
const parseFormattedNumber = (str) => {
    if (typeof str !== 'string') return str;
    return parseInt(str.replace(/,/g, ''));
}

const timeLeft = end => {
  const diff = new Date(end) - new Date();
  if(diff <= 0) return 'ê²½ë§¤ ì¢…ë£Œ';
  const d = Math.floor(diff/86400000);
  const h = Math.floor((diff%86400000)/3600000);
  const m = Math.floor((diff%3600000)/60000);
  const s = Math.floor((diff%60000)/1000);
  return d ? `${d}ì¼ ${h}ì‹œê°„ ë‚¨ìŒ` : `${h}ì‹œê°„ ${m}ë¶„ ${s}ì´ˆ`;
};

// ë°ì´í„° ê´€ë¦¬
const load = () => state.products = JSON.parse(localStorage.getItem('w_products')||'[]');
const save = () => localStorage.setItem('w_products', JSON.stringify(state.products));
const loadUsers = () => JSON.parse(localStorage.getItem('w_users')||'[]');
const saveUsers = u => localStorage.setItem('w_users', JSON.stringify(u));
const randPw = () => Math.random().toString(36).slice(-8);
const getUserName = email => loadUsers().find(u => u.email === email)?.name || 'ìµëª…';
const getMaskedName = email => {
    const name = getUserName(email);
    if (name.length > 1) {
        // ì´ë¦„ì´ 2ê¸€ì ì´ìƒì´ë©´ ê°€ìš´ë°ë¥¼ ë§ˆìŠ¤í‚¹ ì²˜ë¦¬ (ì˜ˆ: í™ê¸¸ë™ -> í™*ë™)
        return name[0] + '*'.repeat(name.length - 2) + name[name.length - 1];
    }
    return name; // 1ê¸€ì ì´ë¦„ì€ ê·¸ëŒ€ë¡œ í‘œì‹œ
};

// ì„¸ì…˜ ê´€ë¦¬
const loadSession = () => {
    const s = localStorage.getItem('w_session');
    if(s) state.session = JSON.parse(s);
};
const saveSession = (s) => {
    state.session = s;
    if(s) localStorage.setItem('w_session', JSON.stringify(s));
    else localStorage.removeItem('w_session');
};

const root = document.getElementById('app');

const render = () => {
  if(state.timerId) { clearInterval(state.timerId); state.timerId = null; }
  load(); // ë Œë”ë§ ì‹œ ë°ì´í„° ìµœì‹ í™”
  root.innerHTML = '';

  // ===== í—¤ë” =====
  const header = el('header',{class:'bg-white shadow p-4 rounded flex justify-between items-center mb-6 flex-wrap gap-3'});
  header.appendChild(el('div',{class:'flex items-center gap-3'},`
    <div class="text-2xl font-bold text-sky-600 cursor-pointer" onclick="state.view='main';render()">ìœ„ë„ˆìŠ¤</div>
    <div class="text-sm text-gray-500 hidden sm:block">ì‘ì€ ê±°ë˜ë„ ì¦ê±°ìš´ ê²½ë§¤</div>
  `));
  const nav = el('div',{class:'flex items-center gap-2 flex-wrap'});
  if(state.session){
    nav.appendChild(el('span',{class:'text-sm font-medium'},state.session.name + 'ë‹˜'));
    nav.appendChild(el('button',{class:'px-3 py-1 border rounded text-sm',onclick:()=>{saveSession(null); state.view='main'; render();}},'ë¡œê·¸ì•„ì›ƒ'));
    nav.appendChild(el('button',{class:'px-3 py-1 border rounded text-sm',onclick:()=>{state.view='myBids';render();}},'ë‚´ ì…ì°°'));
    nav.appendChild(el('button',{class:'px-3 py-1 border rounded text-sm',onclick:()=>{state.view='mySales';render();}},'ë‚´ íŒë§¤'));
    nav.appendChild(el('button',{class:'px-3 py-1 bg-sky-500 text-white rounded text-sm',onclick:()=>{state.view='create';render();}},'ìƒí’ˆë“±ë¡'));
  }else{
    nav.appendChild(el('button',{class:'px-3 py-1 border rounded text-sm',onclick:()=>{state.view='login';render();}},'ë¡œê·¸ì¸'));
    nav.appendChild(el('button',{class:'px-3 py-1 border rounded text-sm',onclick:()=>{state.view='signup';render();}},'íšŒì›ê°€ì…'));
  }
  header.appendChild(nav);
  root.appendChild(header);

  // ===== ë¼ìš°íŒ… =====
  if(state.view==='main') mainView();
  else if(state.view==='login') loginView();
  else if(state.view==='signup') signupView();
  else if(state.view==='findId') findIdView();
  else if(state.view==='findPw') findPwView();
  else if(state.view==='list'){ listView(); }
  else if(state.view==='create') createView();
  else if(state.view==='detail' && state.detail) detailView(state.detail);
  else if(state.view==='myBids'){ myBidsView(); }
  else if(state.view==='mySales'){ mySalesView(); }
  else if(state.view==='edit' && state.detail) createView(state.detail); // ìˆ˜ì • ëª¨ë“œ
  else mainView();
  
  // ë Œë”ë§ í›„ ë™ì ìœ¼ë¡œ í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì •
  setTimeout(adjustTextSizes, 0);
};

// ===== ë™ì  í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • í•¨ìˆ˜ ì¶”ê°€ (ìµœì¢… ë°˜ì˜) =====
function adjustTextSizes() {
    document.querySelectorAll('.shrink-text-container').forEach(container => {
        const textElement = container.querySelector('.shrink-text');
        if (!textElement) return;

        // ì´ˆê¸° í¬ê¸°ë¥¼ text-xl (20px)ë¡œ ì„¤ì •
        textElement.style.transform = 'scale(1)';
        textElement.style.fontSize = '1.25rem'; // ê¸°ë³¸ í°íŠ¸ í¬ê¸°

        // í…ìŠ¤íŠ¸ ë„ˆë¹„ê°€ ë¶€ëª¨ ì»¨í…Œì´ë„ˆ ë„ˆë¹„ë¥¼ ì´ˆê³¼í•˜ëŠ”ì§€ í™•ì¸
        const containerWidth = container.clientWidth;
        const textWidth = textElement.scrollWidth;

        if (textWidth > containerWidth) {
            // ë¹„ìœ¨ì— ë§ê²Œ ì¶•ì†Œ
            let scaleFactor = containerWidth / textWidth;
            
            // ë„ˆë¬´ ë§ì´ ì¶•ì†Œë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ìµœì†Œ í°íŠ¸ í¬ê¸° ì œí•œ (15px, ì•½ 0.75 ìŠ¤ì¼€ì¼)
            const minScale = 0.75; 
            if (scaleFactor < minScale) {
                scaleFactor = minScale;
            }

            textElement.style.transform = `scaleX(${scaleFactor})`;
        }
    });
}

function mainView() {
  load(); 
  const todayStr = new Date().toDateString();
  const todayCount = state.products.filter(p => new Date(p.id).toDateString() === todayStr).length;

  const hero = el('section',{class:'relative bg-gradient-to-br from-sky-600 via-sky-500 to-cyan-400 text-white overflow-hidden rounded-2xl shadow-2xl'});
  hero.innerHTML = `
    <div class="absolute inset-0 opacity-20">
      <div class="absolute top-10 left-10 w-96 h-96 bg-white rounded-full blur-3xl"></div>
      <div class="absolute bottom-20 right-20 w-80 h-80 bg-yellow-300 rounded-full blur-3xl"></div>
    </div>
    
    <div class="relative max-w-7xl mx-auto px-8 py-16 flex flex-col md:flex-row items-center justify-between gap-10">
      <div class="text-center md:text-left z-10 flex-1">
        <div class="inline-block bg-white/20 backdrop-blur-sm px-4 py-1 rounded-full text-sm font-bold mb-6 border border-white/30">
          ğŸ”¥ ì˜¤ëŠ˜ ë“±ë¡ëœ ì‹ ê·œìƒí’ˆì´ <span class="text-yellow-300 text-lg">${todayCount}</span>ê°œ ìˆìŠµë‹ˆë‹¤.
        </div>
        <h1 class="text-4xl md:text-6xl font-extrabold mb-6 leading-tight">
          ì‘ì€ ê±°ë˜ë„<br>ì¦ê±°ìš´ ê²½í—˜ìœ¼ë¡œ
        </h1>
        <p class="text-xl md:text-2xl mb-10 text-sky-100 font-bold">
          ìœ„ë„ˆìŠ¤ì—ì„œ 
          <span class="text-yellow-300 fade-a">íŒ”ë˜? ë§ë˜?</span>
          <span class="text-yellow-300 fade-b"> ì‚´ë˜? ë§ë˜?</span>
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
           <button onclick="state.view='list';render()" class="px-8 py-4 bg-white text-sky-600 rounded-xl font-bold text-lg shadow-lg hover:bg-gray-50 transition transform hover:scale-105">
            êµ¬ê²½í•˜ëŸ¬ ê°€ê¸°
          </button>
          ${state.session ? `<button onclick="state.view='create';render()" class="px-8 py-4 bg-sky-700 text-white rounded-xl font-bold text-lg shadow-lg hover:bg-sky-800 transition transform hover:scale-105">ìƒí’ˆ ì˜¬ë¦¬ê¸°</button>` : ''}
        </div>
      </div>

      <div class="flex-1 relative w-full max-w-lg h-96 hidden md:block">
        <div class="absolute top-0 right-10 w-40 h-40 bg-white p-2 rounded-2xl shadow-2xl animate-float rotate-3 z-20">
          <img src="https://placehold.co/300x300/e0f2fe/0284c7?text=Electronics" class="w-full h-full object-cover rounded-xl" alt="ì „ìê¸°ê¸°">
          <div class="absolute -bottom-3 -right-3 bg-yellow-400 text-sky-900 text-xs font-bold px-2 py-1 rounded">HOT</div>
        </div>
        <div class="absolute bottom-10 left-10 w-36 h-36 bg-white p-2 rounded-2xl shadow-2xl animate-float-delay -rotate-6 z-10">
          <img src="https://placehold.co/300x300/fce7f3/db2777?text=Doll" class="w-full h-full object-cover rounded-xl" alt="ì¸í˜•">
        </div>
        <div class="absolute top-20 left-20 w-32 h-32 bg-white p-2 rounded-2xl shadow-xl z-0">
          <img src="https://placehold.co/300x300/fff7ed/ea580c?text=Book" class="w-full h-full object-cover rounded-xl" alt="ì±…">
        </div>
        <div class="absolute bottom-0 right-20 w-32 h-32 bg-white p-2 rounded-2xl shadow-xl z-0 rotate-12">
          <img src="https://placehold.co/300x300/f0fdf4/16a34a?text=Living" class="w-full h-full object-cover rounded-xl" alt="ìƒí™œìš©í’ˆ">
        </div>
      </div>
    </div>
  `;
  root.appendChild(hero);
}
function findIdView() {
  const card = el('div',{class:'max-w-md mx-auto bg-white rounded-xl shadow p-8'});
  card.innerHTML = `<h2 class="text-2xl font-bold text-sky-600 mb-6 text-center">ì•„ì´ë”” ì°¾ê¸°</h2>`;
  const form = el('form',{onsubmit:e=>{
    e.preventDefault();
    const name = e.target[0].value.trim();
    const y = e.target[1].value;
    const m = e.target[2].value.padStart(2,'0');
    const d = e.target[3].value.padStart(2,'0');
    const birth = `${y}-${m}-${d}`;
    const phone = e.target[4].value;
    const user = loadUsers().find(u=>u.name===name && u.birth===birth && u.phone===phone);
    if(!user) return toast('ì¼ì¹˜í•˜ëŠ” ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤');
    toast(`íšŒì›ë‹˜ì˜ ì•„ì´ë””ëŠ”\n\n${user.email}\n\nì…ë‹ˆë‹¤`);
  }});
  
  form.innerHTML = `
    <input class="w-full border rounded px-4 py-2 mb-4" placeholder="ì„±ëª…" required>
    <div class="flex gap-2 mb-4">
      <input type="text" maxlength="4" class="w-1/2 border rounded px-4 py-2 text-center" placeholder="ì¶œìƒì—°ë„(yyyy)" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      <input type="text" maxlength="2" class="w-1/4 border rounded px-4 py-2 text-center" placeholder="ì›”(mm)" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      <input type="text" maxlength="2" class="w-1/4 border rounded px-4 py-2 text-center" placeholder="ì¼(dd)" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
    </div>
    <input type="text" maxlength="13" class="w-full border rounded px-4 py-2 mb-6" placeholder="íœ´ëŒ€í°ë²ˆí˜¸ (ìˆ«ìë§Œ ì…ë ¥)" required oninput="autoHyphen(this)">
    <button class="w-full bg-sky-500 text-white py-3 rounded font-bold">ì•„ì´ë”” ì°¾ê¸°</button>
  `;
  card.appendChild(form);
  card.innerHTML += `<p class="text-center mt-4 text-sm"><span class="text-sky-600 cursor-pointer" onclick="state.view='login';render()">â† ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span></p>`;
  root.appendChild(card);
}
function findPwView() {
  const card = el('div',{class:'max-w-md mx-auto bg-white rounded-xl shadow p-8'});
  card.innerHTML = `<h2 class="text-2xl font-bold text-sky-600 mb-6 text-center">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h2>`;
  const form = el('form',{onsubmit:e=>{
    e.preventDefault();
    const email = e.target[0].value.trim();
    const y = e.target[1].value;
    const m = e.target[2].value.padStart(2,'0');
    const d = e.target[3].value.padStart(2,'0');
    const birth = `${y}-${m}-${d}`;
    const phone = e.target[4].value;
    const users = loadUsers();
    const user = users.find(u=>u.email===email && u.birth===birth && u.phone===phone);
    if(!user) return toast('ì¼ì¹˜í•˜ëŠ” ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤');
    const temp = randPw();
    user.password = temp;
    saveUsers(users);
    toast(`ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œê¸‰ ì™„ë£Œ!\n\n${temp}\n\në¡œê·¸ì¸ í›„ ê¼­ ë³€ê²½í•˜ì„¸ìš”`);
    state.view='login'; render();
  }});
  form.innerHTML = `
    <input class="w-full border rounded px-4 py-2 mb-4" placeholder="ì´ë©”ì¼" required>
    <div class="flex gap-2 mb-4">
      <input type="text" maxlength="4" class="w-1/2 border rounded px-4 py-2 text-center" placeholder="ì¶œìƒì—°ë„(yyyy)" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      <input type="text" maxlength="2" class="w-1/4 border rounded px-4 py-2 text-center" placeholder="ì›”(mm)" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      <input type="text" maxlength="2" class="w-1/4 border rounded px-4 py-2 text-center" placeholder="ì¼(dd)" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
    </div>
    <input type="text" maxlength="13" class="w-full border rounded px-4 py-2 mb-6" placeholder="íœ´ëŒ€í°ë²ˆí˜¸ (ìˆ«ìë§Œ ì…ë ¥)" required oninput="autoHyphen(this)">
    <button class="w-full bg-sky-500 text-white py-3 rounded font-bold">ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œê¸‰</button>
  `;
  card.appendChild(form);
  card.innerHTML += `<p class="text-center mt-4 text-sm"><span class="text-sky-600 cursor-pointer" onclick="state.view='login';render()">â† ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span></p>`;
  root.appendChild(card);
}
function signupView() {
  const card = el('div',{class:'max-w-md mx-auto bg-white rounded-xl shadow p-8'});
  card.innerHTML = `<h2 class="text-2xl font-bold text-sky-600 mb-6 text-center">íšŒì›ê°€ì…</h2>`;
  let emailOk = false;
  const form = el('form',{onsubmit:e=>{
    e.preventDefault();
    if(!emailOk) return toast('ì´ë©”ì¼ ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”');
    const name = e.target[0].value.trim();
    const email = e.target[1].value.trim();
    const birth = `${e.target[3].value}-${e.target[4].value.padStart(2,'0')}-${e.target[5].value.padStart(2,'0')}`;
    const phone = e.target[6].value; 
    const pw = e.target[9].value;
    const pwc = e.target[10].value;
    if(pw !== pwc) return toast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
    if(!name || !email || !pw) return toast('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”');
    
    const users = loadUsers();
    users.push({name, email, password:pw, birth, phone});
    saveUsers(users);
    toast('ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”');
    state.view='login'; render();
  }});
  form.innerHTML = `
    <input class="w-full border rounded px-4 py-2 mb-3" placeholder="ì„±ëª…" required>
    <div class="flex gap-2 mb-1"><input id="email" class="flex-1 border rounded px-4 py-2" placeholder="ì´ë©”ì¼" required>
      <button type="button" id="dup" class="px-4 border rounded bg-gray-100 text-sm hover:bg-gray-200">ì¤‘ë³µí™•ì¸</button></div>
    <p id="msg" class="text-sm mb-3 min-h-6"></p>
    <div class="flex gap-2 mb-3">
      <input type="text" maxlength="4" class="w-1/2 border rounded px-4 py-2 text-center" placeholder="ì¶œìƒì—°ë„(yyyy)" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      <input type="text" maxlength="2" class="w-1/4 border rounded px-4 py-2 text-center" placeholder="ì›”(mm)" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      <input type="text" maxlength="2" class="w-1/4 border rounded px-4 py-2 text-center" placeholder="ì¼(dd)" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
    </div>
    <input type="text" maxlength="13" class="w-full border rounded px-4 py-2 mb-3" placeholder="íœ´ëŒ€í°ë²ˆí˜¸ (ìˆ«ìë§Œ ì…ë ¥)" required oninput="autoHyphen(this)">
    <select class="w-full border rounded px-4 py-2 mb-3"><option value="">íšŒì‚¬ ì„ íƒ</option>${COMPANIES.map(c=>`<option>${c}</option>`).join('')}</select>
    <input class="w-full border rounded px-4 py-2 mb-3" placeholder="ì†Œì†ë¶€ì„œ">
    <input type="password" class="w-full border rounded px-4 py-2 mb-3" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
    <input type="password" class="w-full border rounded px-4 py-2 mb-6" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required>
    <button class="w-full bg-sky-500 text-white py-3 rounded font-bold">ê°€ì…í•˜ê¸°</button>
  `;
  card.appendChild(form);
  card.innerHTML += `<p class="text-center mt-4 text-sm">ì´ë¯¸ ê³„ì •ì´ ìˆë‚˜ìš”? <span class="text-sky-600 cursor-pointer" onclick="state.view='login';render()">ë¡œê·¸ì¸</span></p>`;
  root.appendChild(card);
  document.getElementById('dup').onclick = () => {
    const email = document.getElementById('email').value.trim();
    if(!email) return toast('ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”');
    const ok = !loadUsers().some(u=>u.email===email);
    document.getElementById('msg').textContent = ok ? 'ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤' : 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤';
    document.getElementById('msg').style.color = ok ? 'green' : 'red';
    emailOk = ok;
  };
}
function loginView() {
  const card = el('div',{class:'max-w-md mx-auto bg-white rounded-xl shadow p-8'});
  card.innerHTML = `<h2 class="text-2xl font-bold text-sky-600 mb-6 text-center">ë¡œê·¸ì¸</h2>`;
  const form = el('form',{onsubmit:e=>{
    e.preventDefault();
    const email = e.target[0].value.trim();
    const pw = e.target[1].value;
    const user = loadUsers().find(u=>u.email===email && u.password===pw);
    if(!user) return toast('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦½ë‹ˆë‹¤');
    saveSession({email:user.email, name:user.name});
    state.view='list'; render();
  }});
  form.innerHTML = `<input class="w-full border rounded px-4 py-2 mb-4" placeholder="ì´ë©”ì¼" required>
    <input type="password" class="w-full border rounded px-4 py-2 mb-6" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
    <button class="w-full bg-sky-500 text-white py-3 rounded font-bold">ë¡œê·¸ì¸</button>`;
  card.appendChild(form);
  card.innerHTML += `<div class="text-center mt-4 text-sm space-y-2">
    <div><span class="text-sky-600 cursor-pointer" onclick="state.view='findId';render()">ì•„ì´ë”” ì°¾ê¸°</span> | <span class="text-sky-600 cursor-pointer" onclick="state.view='findPw';render()">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</span></div>
    <div>ê³„ì •ì´ ì—†ë‚˜ìš”? <span class="text-sky-600 cursor-pointer" onclick="state.view='signup';render()">íšŒì›ê°€ì…</span></div>
  </div>`;
  root.appendChild(card);
}

// ===== ìƒí’ˆ ë“±ë¡/ìˆ˜ì • (ê²½ë§¤ ì¢…ë£Œ ì¼ì‹œ ì„¤ì • ê¸°ëŠ¥ í¬í•¨) =====
function createView(product=null) {
  const isEdit = !!product;
  const isBidding = product?.bids?.length > 0; // ì…ì°° ì‹œì‘ ì—¬ë¶€
  const card = el('div',{class:'max-w-4xl mx-auto bg-white rounded-xl shadow p-8'});
  card.innerHTML = `<h2 class="text-3xl font-bold text-sky-600 mb-8 text-center">${isEdit ? 'ìƒí’ˆ ìˆ˜ì •' : 'ìƒí’ˆ ë“±ë¡'}</h2>`;
  
  // ì¢…ë£Œì¼ì‹œ ê¸°ë³¸ê°’ ì„¤ì • (ë“±ë¡ ì‹œ: 7ì¼ í›„, ìˆ˜ì • ì‹œ: ê¸°ì¡´ ê°’)
  const defaultEndDate = product?.endDate 
    ? product.endDate.substring(0, 16) // "yyyy-MM-ddTHH:mm" í˜•ì‹ìœ¼ë¡œ í¬ë§·
    : new Date(Date.now() + 7*24*3600000).toISOString().substring(0, 16);


  const form = el('form',{onsubmit:e=>{
    e.preventDefault();
    const title = e.target.querySelector('#title').value.trim();
    const desc = e.target.querySelector('#description').value.trim();
    const type = e.target.querySelector('#auctionType').value;
    const endDateValue = e.target.querySelector('#endDateInput').value; // ì¢…ë£Œì¼ì‹œ ê°’

    // í¬ë§·íŒ…ëœ ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜
    const starting = parseFormattedNumber(e.target.querySelector('#startingPrice').value) || 0;
    const buyNow = parseFormattedNumber(e.target.querySelector('#buyNow').value) || 0;
    const eventRangeStart = parseFormattedNumber(e.target.querySelector('#eventRangeStart').value) || 0;
    const eventRangeEnd = parseFormattedNumber(e.target.querySelector('#eventRangeEnd').value) || 0;
    
    const files = e.target.querySelector('#files').files;

    if(!title) return toast('ìƒí’ˆ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    if(!desc) return toast('ìƒí’ˆ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    if(starting <= 0) return toast('ì‹œì‘ê°€ëŠ” 0ì›ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');
    if(!endDateValue) return toast('ê²½ë§¤ ì¢…ë£Œ ì¼ì‹œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.'); // ìœ íš¨ì„± ê²€ì‚¬ ì¶”ê°€

    if(type === 'event') {
        if (eventRangeStart <= 0 || eventRangeEnd <= 0) return toast('ì´ë²¤íŠ¸ ê²½ë§¤ëŠ” ì‹œì‘ê°€ì™€ ì¢…ë£Œê°€ë¥¼ í•„ìˆ˜ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
        if (eventRangeStart >= eventRangeEnd) return toast('ì´ë²¤íŠ¸ ì¢…ë£Œê°€ëŠ” ì‹œì‘ê°€ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');
    }

    // ìˆ˜ì • ëª¨ë“œ ì²˜ë¦¬
    if(isEdit) {
      const p = state.products.find(item => item.id === product.id);
      if(!p) return toast('ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      
      p.title = title;
      p.description = desc;
      if (!isBidding) { // ì…ì°° ì „ì—ëŠ” ê°€ê²©, íƒ€ì…, ì¢…ë£Œì¼ ë³€ê²½ ê°€ëŠ¥
          p.type = type;
          p.startingPrice = starting;
          p.buyNow = type==='general' ? (buyNow > 0 ? buyNow : null) : null;
          p.eventRangeStart = type==='event' ? eventRangeStart : null;
          p.eventRangeEnd = type==='event' ? eventRangeEnd : null;
          // ì¢…ë£Œ ì¼ì‹œ ìˆ˜ì • ê°€ëŠ¥ (ì…ì°° ì „ì¼ ë•Œë§Œ)
          p.endDate = new Date(endDateValue).toISOString();
      }

      if (files.length > 0) {
        uploadImg(files).then(imgs => {
          p.images = imgs.length ? imgs : p.images;
          save();
          toast('ìƒí’ˆ ìˆ˜ì • ì™„ë£Œ!');
          state.view='detail'; state.detail=p; render();
        });
      } else {
        save();
        toast('ìƒí’ˆ ìˆ˜ì • ì™„ë£Œ!');
        state.view='detail'; state.detail=p; render();
      }
      return;
    }
    
    // ë“±ë¡ ëª¨ë“œ ì²˜ë¦¬
    uploadImg(files).then(imgs => {
      const newProduct = {
        id: Date.now(), 
        title, description: desc, type,
        startingPrice: starting,
        buyNow: type==='general' ? (buyNow > 0 ? buyNow : null) : null,
        eventRangeStart: type==='event' ? eventRangeStart : null,
        eventRangeEnd: type==='event' ? eventRangeEnd : null,
        images: imgs.length ? imgs : [`https://placehold.co/600x400/e0f2fe/0284c7?text=${encodeURIComponent(title)}`],
        endDate: new Date(endDateValue).toISOString(), // ì…ë ¥ê°’ ì‚¬ìš©
        creator: state.session.email,
        bids: [], sold: false,
        eventWinner: null, eventClosed: false 
      };
      state.products.push(newProduct);
      save();
      toast('ìƒí’ˆ ë“±ë¡ ì™„ë£Œ!');
      state.view='list'; render();
    });
  }});

  form.innerHTML = `
    <input id="title" class="w-full border rounded px-4 py-3 mb-4 text-lg" placeholder="ìƒí’ˆ ì œëª©" value="${product?.title || ''}" required>
    <textarea id="description" class="w-full border rounded px-4 py-3 mb-6 h-40 text-lg" placeholder="ìƒí’ˆ ì„¤ëª…ì„ ìì„¸íˆ ì ì–´ì£¼ì„¸ìš”" required>${product?.description || ''}</textarea>
    
    <div class="bg-gray-100 p-4 rounded-lg mb-6">
        <p class="text-sm font-bold text-red-600 mb-2">ğŸ“¢ ê°€ê²©/ê²½ë§¤ ìœ í˜•/ì¢…ë£Œì¼ ë³€ê²½ ì œí•œ ì•ˆë‚´</p>
        <p class="text-xs text-gray-700">${isBidding ? 'ì…ì°°ì´ ì‹œì‘ëœ ìƒí’ˆì€ **ê²½ë§¤ ìœ í˜•, ê°€ê²©, ì¢…ë£Œì¼**ì„ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' : 'ëª¨ë“  í•­ëª© ìˆ˜ì • ê°€ëŠ¥'}</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div><label class="block text-sm font-medium mb-2">ê²½ë§¤ ìœ í˜• *</label>
        <select id="auctionType" class="w-full border rounded px-4 py-3" required 
            onchange="toggleAuctionType(this.value)" ${isBidding ? 'disabled' : ''}>
          <option value="general" ${product?.type === 'general' ? 'selected' : ''}>ì¼ë°˜ ê²½ë§¤</option>
          <option value="event" ${product?.type === 'event' ? 'selected' : ''}>ì´ë²¤íŠ¸ ê²½ë§¤</option>
        </select>
      </div>
      <div><label class="block text-sm font-medium mb-2">ì‹œì‘ê°€ (ìµœì†Œ ì…ì°° ê¸ˆì•¡) *</label>
        <input type="text" id="startingPrice" class="w-full border rounded px-4 py-3" placeholder="ì˜ˆ: 10,000" value="${formatNumber(product?.startingPrice)}" required oninput="formatInput(this)" ${isBidding ? 'disabled' : ''}>
      </div>
    </div>
    
    <div class="mb-6">
        <label class="block text-sm font-medium mb-2">ê²½ë§¤ ì¢…ë£Œ ì¼ì‹œ *</label>
        <input type="datetime-local" id="endDateInput" class="w-full border rounded px-4 py-3" required 
               value="${defaultEndDate}" ${isBidding ? 'disabled' : ''}>
        <p class="text-xs text-gray-500 mt-1">${isBidding ? 'ê²½ë§¤ ì‹œì‘ í›„ ì¢…ë£Œì¼ì‹œëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' : 'ì¢…ë£Œ ì‹œê°ê¹Œì§€ ì •í™•íˆ ì„¤ì •í•´ ì£¼ì„¸ìš”.'}</p>
    </div>
    
    <div id="generalFields" class="${product?.type === 'event' ? 'hidden' : ''}">
      <label class="block text-sm font-medium mb-2">ì¦‰ì‹œêµ¬ë§¤ê°€ (ì„ íƒ)</label>
      <input type="text" id="buyNow" class="w-full border rounded px-4 py-3 mb-6" placeholder="ë¯¸ì…ë ¥ ì‹œ ì¦‰ì‹œêµ¬ë§¤ ë¶ˆê°€" value="${formatNumber(product?.buyNow)}" oninput="formatInput(this)" ${isBidding ? 'disabled' : ''}>
    </div>
    
    <div id="eventFields" class="${product?.type === 'event' ? '' : 'hidden'} bg-yellow-50 p-4 rounded-lg mb-6 border border-yellow-200">
      <h3 class="text-lg font-bold text-yellow-800 mb-3">ì´ë²¤íŠ¸ ë‚™ì°° ë²”ìœ„ ì„¤ì •</h3>
      <div class="grid grid-cols-2 gap-4">
        <div><label class="block text-sm font-medium mb-2">ì´ë²¤íŠ¸ ì‹œì‘ê°€ (ìµœì†Œ ë‚™ì°° ì˜ˆìƒê°€) *</label>
          <input type="text" id="eventRangeStart" class="w-full border border-yellow-400 rounded px-4 py-3" placeholder="ì˜ˆ: 10,000" value="${formatNumber(product?.eventRangeStart)}" oninput="formatInput(this)" ${isBidding ? 'disabled' : ''}>
        </div>
        <div><label class="block text-sm font-medium mb-2">ì´ë²¤íŠ¸ ì¢…ë£Œê°€ (ìµœëŒ€ ë‚™ì°° ì˜ˆìƒê°€) *</label>
          <input type="text" id="eventRangeEnd" class="w-full border border-yellow-400 rounded px-4 py-3" placeholder="ì˜ˆ: 20,000" value="${formatNumber(product?.eventRangeEnd)}" oninput="formatInput(this)" ${isBidding ? 'disabled' : ''}>
        </div>
      </div>
      <p class="text-xs text-gray-700 mt-2">ì…ì°°ìëŠ” [ì‹œì‘ê°€]ì™€ [ì¢…ë£Œê°€] ì‚¬ì´ì˜ ê¸ˆì•¡ë§Œ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¹ì²¨ ê¸ˆì•¡ì€ ë²”ìœ„ ë‚´ì—ì„œ ì¶”ì²¨ë©ë‹ˆë‹¤.</p>
    </div>

    <div class="mb-8">
      <label class="block text-sm font-medium mb-3">ìƒí’ˆ ì‚¬ì§„ (ìµœëŒ€ 3ì¥, ìˆ˜ì • ì‹œ ê¸°ì¡´ ì´ë¯¸ì§€ ëŒ€ì²´)</label>
      <input type="file" id="files" accept="image/*" multiple class="w-full border rounded px-4 py-3">
    </div>
    <button class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold text-xl py-5 rounded-xl transition">${isEdit ? 'ìƒí’ˆ ìˆ˜ì • ì™„ë£Œ' : 'ìƒí’ˆ ë“±ë¡í•˜ê¸°'}</button>
  `;
  card.appendChild(form);
  root.appendChild(card);

  window.toggleAuctionType = (type) => {
    const general = document.getElementById('generalFields');
    const event = document.getElementById('eventFields');
    const buyNow = document.getElementById('buyNow');
    const eventStart = document.getElementById('eventRangeStart');
    const eventEnd = document.getElementById('eventRangeEnd');

    if(type === 'event') {
      general.classList.add('hidden');
      event.classList.remove('hidden');
      buyNow.required = false;
      eventStart.required = true;
      eventEnd.required = true;
    } else {
      general.classList.remove('hidden');
      event.classList.add('hidden');
      buyNow.required = false; // ì¦‰ì‹œêµ¬ë§¤ê°€ëŠ” ì„ íƒ ì‚¬í•­
      eventStart.required = false;
      eventEnd.required = false;
    }
  };
  toggleAuctionType(product?.type || document.getElementById('auctionType').value); 
}

function listView() {
  const wrap = el('div');
  wrap.innerHTML = `<h2 class="text-3xl font-bold text-sky-600 mb-8">ìƒí’ˆ ëª©ë¡</h2>`;
  const search = el('input',{class:'w-full border rounded px-6 py-4 mb-8 text-lg', placeholder:'ìƒí’ˆ ê²€ìƒ‰', value:state.filter, oninput:e=> {state.filter=e.target.value; render();}});
  wrap.appendChild(search);
  const grid = el('div',{class:'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8'});
  state.products.filter(p=>p.title.toLowerCase().includes(state.filter.toLowerCase())).forEach(p=>{
    const current = p.bids?.length ? p.bids[p.bids.length-1].price : p.startingPrice;
    const thumb = p.images?.[0] || `https://placehold.co/400x300/e0f2fe/0284c7?text=${encodeURIComponent(p.title)}`;

    // ê²½ë§¤ ìƒíƒœ ë±ƒì§€ ë¡œì§ (ì œëª© ìœ„ì— í‘œì‹œ)
    const isEnded = new Date(p.endDate) < new Date(); 
    let statusBadge = '';
    if (isEnded) {
        statusBadge = '<span class="bg-gray-500 text-white px-3 py-1 rounded-full text-xs font-bold inline-block">ê²½ë§¤ ì¢…ë£Œ</span>';
    } else {
        statusBadge = '<span class="bg-sky-500 text-white px-3 py-1 rounded-full text-xs font-bold inline-block">ì…ì°° ê°€ëŠ¥</span>';
    }

    // ë³´ì¡° ë±ƒì§€ ë¡œì§ (ê¸°ì¡´ ìœ„ì¹˜ - ê°€ê²© ì•„ë˜ì— í‘œì‹œ)
    const isNew = new Date(p.id).toDateString() === new Date().toDateString();
    const isImminent = new Date(p.endDate) - new Date() < 3 * 3600000 && !isEnded;
    let secondaryBadges = '';
    
    if(isImminent) secondaryBadges += '<span class="mr-2 bg-orange-500 text-white px-3 py-1 rounded-full text-xs font-bold inline-block">ë§ˆê° ì„ë°•</span>';
    if(isNew) secondaryBadges += '<span class="mr-2 bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold inline-block">NEW</span>';
    if(p.type==='event') secondaryBadges += '<span class="mr-2 bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-bold inline-block">ì´ë²¤íŠ¸ ê²½ë§¤</span>';
    

    const itemCard = el('div',{
        class:'bg-white rounded-2xl shadow-lg overflow-hidden cursor-pointer hover:shadow-2xl transition transform hover:-translate-y-2', 
        onclick:()=>{state.detail=p;state.view='detail';render();}
    });

    itemCard.innerHTML = `
      <img src="${thumb}" class="w-full h-64 object-cover bg-gray-50">
      <div class="p-6">
        <div class="mb-3">
            ${statusBadge}
        </div>
        
        <div class="shrink-text-container" title="${p.title}">
            <div class="shrink-text">${p.title}</div>
        </div>
        
        <div class="text-2xl font-bold text-sky-600 mt-2">${formatNumber(current)}ì›</div>
        <div class="text-sm text-gray-500 mt-2">ì…ì°° ${p.bids?.length||0} Â· ë§ˆê° ${fmt(p.endDate)}</div>
        
        <div class="mt-3">${secondaryBadges}</div>
      </div>
    `;
    grid.appendChild(itemCard);
  });
  wrap.appendChild(grid);
  root.appendChild(wrap);
}

// ===== ìƒì„¸í˜ì´ì§€ (ì¼ë°˜ ê²½ë§¤ ì…ì°°ê°€ ê²€ì¦ ë¡œì§ ë°˜ì˜) =====
function detailView(p) {
  const currentPrice = p.bids?.length ? p.bids[p.bids.length-1].price : p.startingPrice;
  const isCreator = p.creator === state.session?.email;
  const isEnded = new Date(p.endDate) < new Date();
  const userName = state.session?.email;

  // ì´ë²¤íŠ¸ ê²½ë§¤ ë‹¹ì²¨ì í™•ì • ë¡œì§ (ì¢…ë£Œ ì‹œì ì— 1íšŒ ì‹¤í–‰)
  if (p.type === 'event' && isEnded && !p.eventClosed) {
      const { eventRangeStart: start, eventRangeEnd: end } = p;
      const validBids = p.bids.filter(b => b.price >= start && b.price <= end);
      
      if (validBids.length > 0) {
          // ë²”ìœ„ ë‚´ ì…ì°° ì¤‘ í•˜ë‚˜ë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ íƒ (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ì•ˆì „í•˜ê²Œ ì¶”ì²¨í•´ì•¼ í•¨)
          const randomIndex = Math.floor(Math.random() * validBids.length);
          const winnerBid = validBids[randomIndex];
          p.eventWinner = winnerBid.user;
          p.sold = true;
          p.winningPrice = winnerBid.price; // ë‹¹ì²¨ ê°€ê²© ì €ì¥
      }
      p.eventClosed = true; // ì´ë²¤íŠ¸ ì¢…ë£Œ ë° ë‹¹ì²¨ ë¡œì§ ì²˜ë¦¬ ì™„ë£Œ
      save(); 
  }

  // ì¼ë°˜ ê²½ë§¤ ë‹¹ì²¨ì í™•ì • ë¡œì§ (ì¢…ë£Œ ì‹œì ì— 1íšŒ ì‹¤í–‰)
  if (p.type === 'general' && isEnded && !p.sold) {
      if (p.bids.length > 0) {
          p.winner = p.bids[p.bids.length - 1].user;
          p.sold = true;
          p.winningPrice = currentPrice;
      }
      save();
  }

  // ì…ì°° ê°€ëŠ¥ ì—¬ë¶€ (ì´ë²¤íŠ¸ ê²½ë§¤: ì˜¤ëŠ˜ ì…ì°° í–ˆëŠ”ì§€ í™•ì¸)
  const isEventBidToday = p.type === 'event' && p.bids.some(b => 
      b.user === userName && fmtDate(b.time) === fmtDate(new Date())
  );
  
  // ë‚™ì°°ì ì •ë³´
  const winnerEmail = p.type === 'event' ? p.eventWinner : p.winner;
  const winnerName = winnerEmail ? getUserName(winnerEmail) : null;
  const isWinner = winnerEmail === userName;
  
  // ë‚™ì°° ì•ˆë‚´ ë¬¸êµ¬
  let statusMessage = '';
  if (isEnded) {
      if (p.sold) {
          const price = p.winningPrice || currentPrice;
          statusMessage = `<div class="text-center bg-green-100 p-6 rounded-xl border-2 border-green-500 mb-8">
              <div class="text-3xl font-bold text-green-600 mb-3">${isWinner ? `ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ${p.type === 'general' ? 'ë‚™ì°°' : 'ë‹¹ì²¨'}ë˜ì…¨ìŠµë‹ˆë‹¤.` : `${p.type === 'general' ? 'ë‚™ì°°' : 'ë‹¹ì²¨'} ì¢…ë£Œ: ${winnerName}ë‹˜ ${p.type === 'general' ? 'ë‚™ì°°' : 'ë‹¹ì²¨'}`}</div>
              ${isWinner ? `<div class="mt-4 text-left text-gray-700 space-y-2 text-sm">
                  <p class="font-bold">ìµœì¢… ê¸ˆì•¡: ${formatNumber(price)}ì›</p>
                  <p>ì œí’ˆ ìˆ˜ë ¹ ì•ˆë‚´: ê²½ë§¤ë¬¼í’ˆ ì „ë‹¬ ë° ì§€ë¶ˆ ë°©ì‹ì€ ìœ„ì¹´í˜ì—ì„œ ì§ê±°ë˜ë¡œ ì´ë£¨ì–´ì§€ë©°, ìì„¸í•œ ì •ë³´ëŠ” íŒë§¤ìê°€ ì±„íŒ…ìœ¼ë¡œ ì•ˆë‚´ ì˜ˆì •ì…ë‹ˆë‹¤.</p>
                  <p>ë‚™ì°°ì ì¤€ë¹„ë¬¼: ë‚™ì°°ê¸ˆì•¡(${formatNumber(price)}ì›) ë° ë¹„í”Œí˜ì´(íŒë§¤ìì—ê²Œ í° ê¸°ì¨ìœ¼ë¡œ ì»¤í”¼í•œì” ì œê³µ)</p>
              </div>` : ''}
          </div>`;
      } else {
          statusMessage = `<div class="text-4xl font-bold text-red-600 mb-8 text-center">ê²½ë§¤ ì¢…ë£Œ (ìœ ì°°)</div>`;
      }
  }
  
  // ê°€ê²© ì •ë³´ UI
  const priceDisplay = el('div', { class: 'grid grid-cols-3 gap-4 mb-8 text-center' });
  
  priceDisplay.appendChild(el('div', { class: 'bg-gray-100 p-3 rounded-lg border border-gray-200' }, 
      `<div class="text-sm text-gray-600 font-medium">ì‹œì‘ê°€</div>
       <div class="text-lg font-bold text-gray-800">${formatNumber(p.startingPrice)}ì›</div>`
  ));
  
  if (p.type === 'general' && p.buyNow) {
      priceDisplay.appendChild(el('div', { class: 'bg-blue-100 p-3 rounded-lg border border-blue-300' },
          `<div class="text-sm text-blue-800 font-medium">ì¦‰ì‹œêµ¬ë§¤ê°€</div>
           <div class="text-lg font-bold text-blue-900">${formatNumber(p.buyNow)}ì›</div>`
      ));
  } else if (p.type === 'event') {
      priceDisplay.appendChild(el('div', { class: 'bg-yellow-100 p-3 rounded-lg border border-yellow-300' },
          `<div class="text-sm text-yellow-800 font-medium">ì…ì°° ë²”ìœ„</div>
           <div class="text-lg font-bold text-yellow-900">${formatNumber(p.eventRangeStart)}ì› ~ ${formatNumber(p.eventRangeEnd)}ì›</div>`
      ));
  } else {
      priceDisplay.appendChild(el('div', { class: 'bg-gray-100 p-3 rounded-lg border border-gray-200' },
          `<div class="text-sm text-gray-600 font-medium">ì¦‰ì‹œêµ¬ë§¤</div>
           <div class="text-lg font-bold text-gray-400">ì—†ìŒ</div>`
      ));
  }
  
  priceDisplay.appendChild(el('div', { class: 'bg-sky-100 p-3 rounded-lg border border-sky-300' },
      `<div class="text-sm text-sky-800 font-medium">${p.type === 'event' ? 'ìµœê³  ì…ì°°ê°€' : 'í˜„ì¬ ì…ì°°ê°€'}</div>
       <div class="text-2xl font-extrabold text-sky-900">${formatNumber(currentPrice)}ì›</div>`
  ));


  const container = el('div',{class:'max-w-6xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden'});
  container.innerHTML = `
    <div class="grid md:grid-cols-2 gap-8 p-8">
      <div>
        <div class="relative bg-gray-100 rounded-xl overflow-hidden">
          <img src="${p.images?.[0] || 'https://placehold.co/600x400'}" id="mainImg" class="w-full h-96 object-contain bg-gray-50">
          ${p.images?.length > 1 ? `
            <button onclick="prevImg()" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 p-3 rounded-full shadow-lg">â—€</button>
            <button onclick="nextImg()" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 p-3 rounded-full shadow-lg">â–¶</button>
          ` : ''}
        </div>
        ${p.images?.length > 1 ? `
          <div class="flex gap-3 mt-4 flex-wrap">
            ${p.images.map((img,i)=>`<img src="${img}" class="w-24 h-24 object-cover rounded cursor-pointer border-2 ${i===0?'border-sky-500':'border-gray-300'}" onclick="document.getElementById('mainImg').src=this.src">`).join('')}
          </div>
        ` : ''}
      </div>

      <div>
        <h1 class="text-4xl font-bold mb-4">${p.title}</h1>
        ${isCreator ? `<div class="flex gap-2 mb-4">
            <button onclick="state.view='edit'; render()" class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">ìˆ˜ì •</button>
            <button onclick="deleteProduct(${p.id})" class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">ì‚­ì œ</button>
        </div>` : ''}

        <p class="text-gray-600 mb-6 leading-relaxed whitespace-pre-line">${p.description || 'ì„¤ëª… ì—†ìŒ'}</p>
        
        ${priceDisplay.outerHTML}

        <div class="text-xl mb-8">
            ë§ˆê° ì¼ì‹œ: ${fmt(p.endDate)} Â· 
            <span id="timer" class="font-bold text-red-600">${timeLeft(p.endDate)}</span>
        </div>
        
        ${statusMessage}

        ${!isEnded && p.type === 'event' ? `<div class="bg-gray-100 p-4 rounded text-center text-sm font-medium mb-8">
            <p>ì¢…ë£Œì¼ì‹œ(${fmt(p.endDate)})ê¹Œì§€ ì´ë²¤íŠ¸ ê²½ë§¤ ì§„í–‰</p>
            <p class="mt-2 text-red-500">ì…ì°° ë²”ìœ„: ${formatNumber(p.eventRangeStart)}ì›ë¶€í„° ${formatNumber(p.eventRangeEnd)}ì› ì‚¬ì´ì˜ ê¸ˆì•¡ë§Œ ì…ì°° ê°€ëŠ¥</p>
            <p class="text-red-500">ì´ë²¤íŠ¸ ê²½ë§¤ëŠ” í•˜ë£¨ì— í•œ ë²ˆë§Œ ì…ì°° ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        </div>` : ''}

        ${!isEnded && !statusMessage ? // ê²½ë§¤ ì¤‘ì¼ ë•Œ ì…ì°° UI í‘œì‹œ
         !state.session ? `<div class="text-xl text-gray-500 mb-8">ë¡œê·¸ì¸ í›„ ì…ì°° ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>` :
         isCreator ? `<div class="bg-gray-100 p-4 rounded text-center text-xl text-gray-500 mb-8">ë‚´ê°€ ì˜¬ë¦° ìƒí’ˆì…ë‹ˆë‹¤.</div>` : 
         isEventBidToday ? `<div class="bg-red-100 p-4 rounded text-center text-xl text-red-600 font-bold mb-8">ì˜¤ëŠ˜ì€ ì´ë¯¸ ì…ì°°í•˜ì…¨ìŠµë‹ˆë‹¤. ë‚´ì¼ ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!</div>` : `
          <div class="space-y-4 mb-8">
            <input type="text" id="bidAmount" class="w-full border-2 border-sky-500 rounded-xl px-6 py-5 text-2xl text-center" 
                   placeholder="${p.type==='event' ? `${formatNumber(p.eventRangeStart)} ~ ${formatNumber(p.eventRangeEnd)}` : formatNumber(currentPrice + 1000)}"
                   oninput="formatInput(this)">
            <button onclick="placeBid(${p.id})" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold text-2xl py-6 rounded-xl transition">
              ${p.type==='event' ? 'ì´ë²¤íŠ¸ ì…ì°° (ì˜¤ëŠ˜ 1íšŒ ê°€ëŠ¥)' : 'ì…ì°°í•˜ê¸°'}
            </button>
            ${p.type === 'general' && p.buyNow ? `<button onclick="buyNow(${p.id})" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold text-2xl py-6 rounded-xl transition">ì¦‰ì‹œêµ¬ë§¤ ${formatNumber(p.buyNow)}ì›</button>` : ''}
          </div>
        `: ''}

        <div class="mt-10">
          <h3 class="text-2xl font-bold mb-4">ì…ì°° ë‚´ì—­</h3>
          <div class="space-y-3 max-h-96 overflow-y-auto">
            ${p.bids?.length ? p.bids.slice().reverse().map(b=>`
              <div class="flex justify-between p-4 bg-gray-50 rounded-xl">
                <div>${getMaskedName(b.user)}ë‹˜${b.user===state.session?.email ? ' <span class="text-sky-600 text-xs font-bold">(ë‚˜)</span>' : ''}</div>
                <div class="text-right">
                  <div class="font-bold text-sky-600">${formatNumber(b.price)}ì›</div>
                  <div class="text-sm text-gray-500">${fmt(b.time)}</div>
                </div>
              </div>
            `).join('') : '<p class="text-center text-gray-500 py-8">ì•„ì§ ì…ì°°ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ì…ì°°ìê°€ ë˜ì–´ë³´ì„¸ìš”!</p>'}
          </div>
        </div>
      </div>
    </div>
  `;

  root.appendChild(container);

  state.timerId = setInterval(() => {
    const t = document.getElementById('timer');
    if(t) {
      const remaining = timeLeft(p.endDate);
      t.textContent = remaining;
      if (remaining === 'ê²½ë§¤ ì¢…ë£Œ') {
          clearInterval(state.timerId);
          render(); 
      }
    }
  }, 1000);

  let imgIdx = 0;
  window.prevImg = () => { imgIdx = (imgIdx - 1 + p.images.length) % p.images.length; document.getElementById('mainImg').src = p.images[imgIdx]; };
  window.nextImg = () => { imgIdx = (imgIdx + 1) % p.images.length; document.getElementById('mainImg').src = p.images[imgIdx]; };

  window.placeBid = id => {
    const product = state.products.find(item => item.id === id);
    const amountStr = document.getElementById('bidAmount').value;
    const amount = parseFormattedNumber(amountStr);
    
    // ìœ íš¨ì„± ê²€ì‚¬ 1: ê¸ˆì•¡ ìœ íš¨ì„±
    if(!amount || amount <= 0) return toast('ì…ì°°ê°€ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.');

    // ì´ë²¤íŠ¸ ê²½ë§¤ ë¡œì§ (í•˜ë£¨ 1íšŒ ì…ì°°, ë²”ìœ„ í™•ì¸)
    if (product.type === 'event') {
        const isEventBidToday = product.bids.some(b => 
            b.user === state.session.email && fmtDate(b.time) === fmtDate(new Date())
        );

        if (isEventBidToday) return toast('ì´ë²¤íŠ¸ ê²½ë§¤ëŠ” í•˜ë£¨ì— í•œ ë²ˆë§Œ ì…ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        
        const { eventRangeStart: start, eventRangeEnd: end } = product;
        if (amount < start || amount > end) {
             return toast(`ì´ë²¤íŠ¸ ê²½ë§¤ëŠ” ${formatNumber(start)}ì›ë¶€í„° ${formatNumber(end)}ì› ì‚¬ì´ì˜ ê¸ˆì•¡ë§Œ ì…ì°° ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
        }
    } 
    // ì¼ë°˜ ê²½ë§¤ ë¡œì§: ì´ì „ ì…ì°°ê°€ë³´ë‹¤ ë¬´ì¡°ê±´ ì»¤ì•¼ í•¨ (ìµœì¢… ìˆ˜ì • ë°˜ì˜)
    else if (product.type === 'general') {
        const currentPrice = product.bids?.length ? product.bids[product.bids.length-1].price : product.startingPrice;

        if(amount <= currentPrice) return toast('í˜„ì¬ ìµœê³ ê°€ë³´ë‹¤ ë†’ì€ ê¸ˆì•¡ìœ¼ë¡œ ì…ì°°í•˜ì„¸ìš”.');
    }
    
    // ìµœì¢… ì…ì°° ì²˜ë¦¬
    product.bids.push({user: state.session.email, price: amount, time: new Date().toISOString()});
    save();
    toast('ì…ì°°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
    render();
  };

  window.buyNow = id => {
    const product = state.products.find(item => item.id === id);
    if(confirm(`ì¦‰ì‹œêµ¬ë§¤ ${formatNumber(product.buyNow)}ì› í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){
      product.sold = true;
      product.winner = state.session.email;
      product.winningPrice = product.buyNow;
      product.bids.push({user: state.session.email, price: product.buyNow, time: new Date().toISOString()});
      save();
      toast('ì¦‰ì‹œêµ¬ë§¤ ì™„ë£Œ! ì¶•í•˜í•©ë‹ˆë‹¤.');
      render();
    }
  };

  window.deleteProduct = id => {
      if (confirm('ì •ë§ë¡œ ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤)')) {
          state.products = state.products.filter(p => p.id !== id);
          save();
          toast('ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          state.view = 'mySales';
          render();
      }
  };
}

// ===== ë‚´ ì…ì°° / ë‚´ íŒë§¤ (ë³€ê²½ ì—†ìŒ) =====
function myBidsView() {
    const wrap = el('div');
    const myBidProducts = state.products.filter(p => p.bids.some(b => b.user === state.session.email));
    wrap.innerHTML = `<h2 class="text-3xl font-bold text-sky-600 mb-8">ë‚´ ì…ì°° ë‚´ì—­</h2>`;
    if(myBidProducts.length === 0) {
        wrap.innerHTML += `<p class="text-center text-gray-500 py-10 bg-white rounded-xl shadow">ì•„ì§ ì…ì°°í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
    } else {
        const grid = el('div',{class:'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6'});
        myBidProducts.forEach(p => {
            const myBids = p.bids.filter(b=>b.user===state.session.email);
            const myLastBid = myBids.pop();
            const current = p.bids[p.bids.length-1].price;
            let statusBadge = '';
            let borderColor = 'border-gray-300';

            const isEnded = new Date(p.endDate) < new Date();

            if (p.type === 'event') {
                if (isEnded) {
                    if (p.eventWinner === state.session.email) {
                        statusBadge = '<span class="bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold">ğŸ‰ ë‹¹ì²¨</span>';
                        borderColor = 'border-green-500';
                    }
                    else {
                        statusBadge = '<span class="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold">âŒ ë‚™ì²¨</span>';
                        borderColor = 'border-red-500';
                    }
                } else {
                    statusBadge = `<span class="bg-blue-500 text-white px-3 py-1 rounded-full text-xs font-bold">ì…ì°° ${myBids.length + 1}íšŒ</span>`;
                    borderColor = 'border-blue-500';
                }
            } else { // ì¼ë°˜ ê²½ë§¤
                if (isEnded) {
                    if (p.winner === state.session.email) {
                        statusBadge = '<span class="bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold">ğŸ‰ ë‚™ì°°</span>';
                        borderColor = 'border-green-500';
                    }
                    else {
                        statusBadge = '<span class="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold">âŒ ìœ ì°°</span>';
                        borderColor = 'border-red-500';
                    }
                } else {
                    const isWinning = myLastBid.price === current;
                    statusBadge = `<span class="px-3 py-1 rounded-full text-xs font-bold ${isWinning ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}">${isWinning ? 'í˜„ì¬ ìµœê³ ê°€!' : 'ì…ì°° ë°€ë¦¼'}</span>`;
                    borderColor = isWinning ? 'border-green-300' : 'border-red-300';
                }
            }
            

            grid.appendChild(el('div',{class:`bg-white rounded-xl shadow p-6 border-l-4 ${borderColor} cursor-pointer`, onclick:()=>{state.detail=p;state.view='detail';render();}}, `
                <div class="font-bold text-lg mb-2 truncate">${p.title}</div>
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-sm text-gray-500">ë‚´ ìµœì¢… ì…ì°°ê°€</div>
                        <div class="font-bold text-xl">${formatNumber(myLastBid.price)}ì›</div>
                    </div>
                    <div class="text-right space-y-1">
                        ${statusBadge}
                        <div class="text-sm text-gray-400">í˜„ì¬ê°€ ${formatNumber(current)}ì›</div>
                    </div>
                </div>
            `));
        });
        wrap.appendChild(grid);
    }
    root.appendChild(wrap);
}
// ===== ë‚´ íŒë§¤ ê´€ë¦¬ ìˆ˜ì •ëœ í•¨ìˆ˜ (ì˜¤ë¥˜ ìˆ˜ì •) =====
function mySalesView() {
    const wrap = el('div');
    const myProducts = state.products.filter(p => p.creator === state.session.email);
    wrap.innerHTML = `<h2 class="text-3xl font-bold text-sky-600 mb-8">ë‚´ íŒë§¤ ê´€ë¦¬</h2>`;
    
    if(myProducts.length === 0) {
        wrap.innerHTML += `<p class="text-center text-gray-500 py-10 bg-white rounded-xl shadow">ë“±ë¡í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤. ìƒí’ˆì„ ë“±ë¡í•´ë³´ì„¸ìš”!</p>`;
    } else {
        const list = el('div',{class:'space-y-4'});
        
        // í…Œì´ë¸” í—¤ë”
        list.appendChild(el('div', { class: 'hidden sm:grid grid-cols-7 gap-4 text-sm font-bold text-gray-600 p-4 bg-gray-200 rounded-t-xl' }, `
            <div class="col-span-2">ìƒí’ˆ ì •ë³´</div>
            <div class="text-right">ê²½ë§¤ ìœ í˜•</div>
            <div class="text-right">ì‹œì‘ê°€</div>
            <div class="text-right">í˜„ì¬ ì…ì°°ê°€</div>
            <div class="text-right">ë‚™ì°°ê°€</div>
            <div class="text-right">ìƒíƒœ / ê´€ë¦¬</div>
        `));

        myProducts.forEach(p => {
            const currentPrice = p.bids.length ? p.bids[p.bids.length-1].price : p.startingPrice;
            
            // ë‚™ì°°ê°€ ì •ë³´ (ì˜¤ë¥˜ ìˆ˜ì •: í…œí”Œë¦¿ ë¦¬í„°ëŸ´ ë‚´ë¶€ì˜ ë¬¸ìì—´/ë³€ìˆ˜ ì²˜ë¦¬ ì•ˆì •í™”)
            const winningPrice = p.sold && p.winningPrice ? `${formatNumber(p.winningPrice)}ì›` : '-';

            let status = '';
            const isEnded = new Date(p.endDate) < new Date();
            const isBidding = p.bids.length > 0;
            const auctionTypeLabel = p.type === 'event' ? 'ì´ë²¤íŠ¸' : 'ì¼ë°˜';

            if (isEnded) {
                if (p.sold) status = `<span class="bg-green-500 text-white px-2 py-1 rounded text-xs font-bold">${p.type === 'event' ? 'ë‹¹ì²¨ ì™„ë£Œ' : 'ë‚™ì°° ì™„ë£Œ'}</span>`;
                else status = `<span class="bg-red-500 text-white px-2 py-1 rounded text-xs font-bold">ìœ ì°°</span>`;
            } else {
                status = `<span class="text-gray-500 text-sm">${timeLeft(p.endDate)}</span>`;
            }

            const actions = el('div',{class:'flex gap-2 justify-end'});
            actions.appendChild(el('button',{
                class:'text-blue-500 text-sm hover:underline', 
                // ì´ë²¤íŠ¸ ê°ì²´ë¥¼ í•¨ìˆ˜ë¡œ ì „ë‹¬í•˜ì—¬ ë²„ë¸”ë§ì„ ë§‰ê³ , state ì—…ë°ì´íŠ¸
                onclick: (e) => { e.stopPropagation(); state.detail=p; state.view='edit'; render(); } 
            }, 'ìˆ˜ì •'));

            if (!isBidding) { // ì…ì°°ì´ ì—†ì–´ì•¼ ì‚­ì œ ê°€ëŠ¥
                 actions.appendChild(el('button',{
                    class:'text-red-500 text-sm hover:underline', 
                    // ì´ë²¤íŠ¸ ê°ì²´ë¥¼ í•¨ìˆ˜ë¡œ ì „ë‹¬í•˜ì—¬ ë²„ë¸”ë§ì„ ë§‰ê³ , deleteProduct í•¨ìˆ˜ í˜¸ì¶œ
                    onclick: (e) => { e.stopPropagation(); deleteProduct(p.id); } 
                }, 'ì‚­ì œ'));
            } else {
                 actions.appendChild(el('span',{
                    class:'text-gray-400 text-sm', 
                }, 'ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€')); // ì…ì°° ì‹œì‘ ì‹œ ìˆ˜ì •/ì‚­ì œ ì œí•œ ì•ˆë‚´
            }


            const itemDiv = el('div',{class:'bg-white rounded-xl shadow p-4 flex flex-col sm:grid sm:grid-cols-7 gap-4 items-center cursor-pointer hover:bg-gray-50', onclick:()=>{state.detail=p;state.view='detail';render();}});
            
            // ìƒí’ˆ ì •ë³´ (1ì—´)
            const infoDiv = el('div',{class:'col-span-2 flex items-center gap-3 w-full'});
            infoDiv.innerHTML = `<img src="${p.images?.[0] || 'https://placehold.co/100'}" class="w-16 h-16 rounded object-cover">
                <div class="truncate flex-1">
                    <div class="font-bold text-base truncate">${p.title}</div>
                    <div class="text-xs text-gray-500">ì…ì°° ${p.bids.length}ê±´</div>
                </div>`;
            itemDiv.appendChild(infoDiv);

            // ê²½ë§¤ ìœ í˜• (2ì—´)
            itemDiv.appendChild(el('div', { class: 'text-right sm:text-center w-full sm:w-auto text-sm font-medium border-t sm:border-t-0 pt-2 sm:pt-0' }, `<span class="sm:hidden font-bold">ìœ í˜•: </span>${auctionTypeLabel}`));
            
            // ì‹œì‘ê°€ (3ì—´)
            itemDiv.appendChild(el('div', { class: 'text-right w-full sm:w-auto text-sm border-t sm:border-t-0 pt-2 sm:pt-0' }, `<span class="sm:hidden font-bold">ì‹œì‘ê°€: </span>${formatNumber(p.startingPrice)}ì›`));

            // í˜„ì¬ ì…ì°°ê°€ (4ì—´)
            itemDiv.appendChild(el('div', { class: 'text-right w-full sm:w-auto text-sm font-bold text-sky-600 border-t sm:border-t-0 pt-2 sm:pt-0' }, `<span class="sm:hidden font-bold">í˜„ì¬ê°€: </span>${formatNumber(currentPrice)}ì›`));

            // ë‚™ì°°ê°€ (5ì—´)
            itemDiv.appendChild(el('div', { class: `text-right w-full sm:w-auto text-sm font-bold border-t sm:border-t-0 pt-2 sm:pt-0 ${p.sold ? 'text-green-600' : 'text-gray-400'}` }, `<span class="sm:hidden font-bold">ë‚™ì°°ê°€: </span>${winningPrice}`));

            // ìƒíƒœ / ê´€ë¦¬ (6ì—´ - 2ì¹¸ ì°¨ì§€)
            const statusActionDiv = el('div', { class: 'col-span-2 text-right w-full border-t sm:border-t-0 pt-2 sm:pt-0 space-y-1' });
            statusActionDiv.appendChild(el('div', {}, status));
            statusActionDiv.appendChild(actions);
            itemDiv.appendChild(statusActionDiv);
            
            list.appendChild(itemDiv);
        });
        wrap.appendChild(list);
    }
    root.appendChild(wrap);
}

// ì´ë¯¸ì§€ ì—…ë¡œë“œ ë”ë¯¸ í•¨ìˆ˜
const uploadImg = (files) => new Promise(resolve => {
    // ì‹¤ì œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ë¡œì§ ëŒ€ì‹ , í”Œë ˆì´ìŠ¤í™€ë” URLì„ ë°˜í™˜
    const urls = Array.from(files).map((f, i) => `https://placehold.co/600x400/e0f2fe/0284c7?text=Image+${i+1}`);
    setTimeout(() => resolve(urls), 500);
});

// íœ´ëŒ€í°ë²ˆí˜¸ ìë™ í•˜ì´í”ˆ (-) ì¶”ê°€ í•¨ìˆ˜ (signupView ë“±ì—ì„œ ì‚¬ìš©)
function autoHyphen(target) {
    target.value = target.value
        .replace(/[^0-9]/g, '')
        .replace(/^(\d{2,3})(\d{3,4})(\d{4})$/, `$1-$2-$3`);
}

// ===== ìë™ ë¡œê·¸ì¸ í•¨ìˆ˜ (ë°ëª¨ìš©) =====
const autoLogin = () => {
  const demoUser = {email:'demo@user.com', name:'ë°ëª¨ê¹€'};
  
  // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì„¸ì…˜ ì €ì¥
  localStorage.setItem('w_session', JSON.stringify(demoUser));
  
  // ìƒíƒœì— ì„¸ì…˜ ì—…ë°ì´íŠ¸ ë° ì‹œì‘ ë·°ë¥¼ ëª©ë¡ìœ¼ë¡œ ë³€ê²½
  state.session = demoUser;
  state.view = 'list';
};

// ===== ì´ˆê¸°í™” ë° ë°ëª¨ ë°ì´í„° ì„¤ì • (ìë™ ë¡œê·¸ì¸ í¬í•¨) =====
if(!localStorage.getItem('w_users') || loadUsers().length===0){
  saveUsers([{name:'ë°ëª¨ê¹€',email:'demo@user.com',password:'demo',birth:'1990-01-01',phone:'010-1234-5678'}]);
  saveUsers(loadUsers().concat([{name:'ê²½ë§¤ì™•',email:'winner@user.com',password:'1234',birth:'1995-05-05',phone:'010-9876-5432'}]));
  saveUsers(loadUsers().concat([{name:'ìš´ì˜ì',email:'admin@winners.com',password:'1234',birth:'2000-01-01',phone:'010-0000-0000'}]));
}
if(!localStorage.getItem('w_products') || load().length===0){
  state.products = [
    // [ë‚´ íŒë§¤] ì¼ë°˜ ê²½ë§¤ í…ŒìŠ¤íŠ¸ ìƒí’ˆ (ë‚™ì°° ì˜ˆì • - ë‚´ê°€ ì˜¬ë¦° ìƒí’ˆ)
    {
      id:Date.now()-1000, 
      title:'[ë‚´ê°€ íŒ ìƒí’ˆ] ì—ì–´íŒŸ í”„ë¡œ 2ì„¸ëŒ€ (ì§„í–‰ì¤‘)',
      description:'ê±°ì˜ ìƒˆê²ƒ',
      type:'general',
      startingPrice:180000,
      buyNow:250000,
      images:['https://placehold.co/400x400/e0f2fe/0284c7?text=My+Sale'],
      endDate:new Date(Date.now()+48*3600000).toISOString(),
      creator:'demo@user.com', // ë‚´ ìƒí’ˆ
      bids:[
        {user:'winner@user.com', price: 190000, time: new Date(Date.now()-700000).toISOString()},
        {user:'other@user.com', price: 195000, time: new Date(Date.now()-600000).toISOString()},
      ],
      sold:false,
      eventRangeStart:null, 
      eventRangeEnd:null,
      winningPrice: null // ë‚™ì°°ê°€
    },
    // [ë‚´ íŒë§¤] ì´ë²¤íŠ¸ ê²½ë§¤ í…ŒìŠ¤íŠ¸ ìƒí’ˆ (ë‹¹ì²¨ ì™„ë£Œ - ë‚´ê°€ ì˜¬ë¦° ìƒí’ˆ)
     {
      id:Date.now()-2000,
      title:'[ë‚´ê°€ íŒ ìƒí’ˆ] ì´ë²¤íŠ¸ - ë‹¹ì²¨ ì™„ë£Œ ìƒí’ˆëª… ë§¤ìš° ê¸¸ê²Œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì´ ì œëª©ì´ í•œ ì¤„ì— ëª¨ë‘ ë³´ì´ë„ë¡ í•´ì£¼ì„¸ìš”. ê¸€ì”¨ê°€ ì‘ì•„ì ¸ë„ ê´œì°®ìŠµë‹ˆë‹¤.',
      description:'ë§Œì›ëŒ€ ë§ì¶”ê¸° ì„±ê³µ',
      type:'event',
      startingPrice:1000,
      buyNow:null,
      eventRangeStart:10000,
      eventRangeEnd:19999,
      images:['https://placehold.co/400x400/fbbf24/000000?text=Event+Sold'],
      endDate:new Date(Date.now()-3600000).toISOString(), // ì´ë¯¸ ì¢…ë£Œëœ ìƒí’ˆ
      creator:'demo@user.com', // ë‚´ ìƒí’ˆ
      bids:[
          {user:'winner@user.com', price: 15000, time: new Date(Date.now()-5*3600000).toISOString()},
      ],
      sold:true,
      eventClosed: true,
      eventWinner: 'winner@user.com', // ë‹¹ì²¨ì
      winningPrice: 15000 // ë‚™ì°°ê°€
    },
    // [ë‚´ ì…ì°°] ì¼ë°˜ ê²½ë§¤ í…ŒìŠ¤íŠ¸ ìƒí’ˆ (ë§ˆê° ì„ë°• -> ìµœê³ ê°€ ì…ì°°: ë‚™ì°° ì˜ˆì •)
    {
      id:Date.now()-86400000,
      title:'[ë‚´ê°€ ì…ì°°] ìŠ¤íƒ€ë²…ìŠ¤ ê¸°í”„í‹°ì½˜ (ë§ˆê° ì„ë°•)',
      description:'ìœ íš¨ê¸°ê°„ ë„‰ë„‰',
      type:'general',
      startingPrice:40000,
      buyNow:null,
      images:['https://placehold.co/400x400/1e3932/ffffff?text=My+Bid'],
      endDate:new Date(Date.now()+2*3600000).toISOString(), // 2ì‹œê°„ í›„ ì¢…ë£Œ (ë§ˆê° ì„ë°•)
      creator:'admin@winners.com',
      bids:[
        {user:'admin@winners.com', price: 40000, time: new Date(Date.now()-10*60000).toISOString()},
        {user:'demo@user.com', price: 45000, time: new Date(Date.now()-5*60000).toISOString()}, // ë‚´ ìµœê³ ê°€ ì…ì°°
      ],
      sold:false,
      eventRangeStart:null,
      eventRangeEnd:null,
      winningPrice: null
    },
    // ì¼ë°˜ ì´ë²¤íŠ¸ ìƒí’ˆ (ì§„í–‰ ì¤‘ - ì…ì°° ì œí•œ í…ŒìŠ¤íŠ¸ìš©)
    {
      id:Date.now()-5000,
      title:'[ì´ë²¤íŠ¸] ë§Œì›ëŒ€ ë§ì¶”ê¸° (ì§„í–‰ ì¤‘) - 24ì‹œê°„ ì…ì°° ì œí•œ í…ŒìŠ¤íŠ¸ìš©ì…ë‹ˆë‹¤.',
      description:'ë§Œì›ëŒ€ ì¤‘ í•˜ë‚˜ë¥¼ ë§ì¶°ë³´ì„¸ìš”!',
      type:'event',
      startingPrice:1000,
      buyNow:null,
      eventRangeStart:10000,
      eventRangeEnd:19999,
      images:['https://placehold.co/400x400/fbbf24/000000?text=Event+Live'],
      endDate:new Date(Date.now()+5*24*3600000).toISOString(),
      creator:'admin@winners.com',
      bids:[
          // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì…ì°° ê¸°ë¡ (ì…ì°° ì œí•œ í…ŒìŠ¤íŠ¸ìš©)
          {user:'demo@user.com', price: 15000, time: new Date().toISOString()}, 
      ],
      sold:false,
      eventClosed: false,
      winningPrice: null
    }
  ];
  save();
}

// ì„¸ì…˜ ë¡œë“œ ì „ì— ìë™ ë¡œê·¸ì¸ ì‹¤í–‰
autoLogin(); 
loadSession();
render();

<script type="module">
  // api.js ëª¨ë“ˆì—ì„œ í•„ìš”í•œ í•¨ìˆ˜ë“¤ì„ import í•©ë‹ˆë‹¤.
  // ì´ import êµ¬ë¬¸ì´ api.jsë¥¼ ë¡œë“œí•˜ê³ , api.jsëŠ” ë‹¤ì‹œ supabase.jsë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
  import * as api from './api.js'; 
  // ë˜ëŠ” import { signup, login, loadProducts } from './api.js'; 

  // ----------------------------------------------------
  // ğŸ‘‡ ì—¬ê¸°ë¶€í„° ê¸°ì¡´ index.htmlì— ìˆë˜ ì „ì²´ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ì„ ìœ ì§€í•©ë‹ˆë‹¤.
  // (state, render, load, save, view í•¨ìˆ˜ë“¤...)
  
  // ì˜ˆì‹œ: ì´ì œ API í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  // async function loginView() {
  //   // ...
  //   try {
  //     const user = await api.login(email, password); // api.jsì˜ login ì‚¬ìš©
  //     // ...
  //   } catch (error) {
  //     // ...
  //   }
  // }
  
  // ... ëª¨ë“  ê²½ë§¤ ê´€ë ¨ ë¡œì§ ...

</script>


</body>
</html>
